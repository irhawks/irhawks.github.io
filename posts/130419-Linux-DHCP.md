---
title : Linux下DHCP服务器的配置
date  : 2013-04-29
author : irhawks
tags  : linux, DHCP
---

<!-- 这些网络服务的复杂参数搞得自己头疼死了，这些人一是在说的时候只说自己的情况，
第二个就是在写的时候文章是大量内容的积累，而不是清楚而明确的一系列参数。-->

DHCP的主配文件便是/etc/dhcpd.conf.

DHCP服务器搭建流程分为几步，第一是编辑主配文件，指定分配的范围等。第二就是建立租约数据文件，第三就是启动或重启DHCP服务，使配置生效。

DHCP的工作过程是客户端以广播的方式向服务器申请IP地址(通过接口连接)。DHCP服务器通常本身接口已经配置好IP并在这个接口上启动了DHCP服务。于是服务器根据DHCP的相关配置给客户端提供IP,GATEWAY,DNS等信息。并且DHCP服务器将本次分配信息存入租约数据库里面。

DHCP的配置文件一般从安装源目录的一个dhcp.conf.sample文件得来。该文件包含了适用于服务器的配置，本行的`#`后面的内容被DHCP服务器视为注释并自动忽略。

DHCP主配文件里面分成参数，选项，声明三种类型。

参数一节表明DHCP服务器如何执行任务，是否执行任务，以及要发送给客户的选项。声明一节用于描述网络的布局，提供给用户的IP地址等。选项一节用来配置DHCP可选参数，都以option关键字作为开始。

先说参数一节里面的重要关键字。

------------------ ----------------------------------------------
default-lease-time 缺省租赁时间的长度，以秒为单位
max-lease-time     最大租赁时间的长度，以秒为单位
hardware           指定网卡接口类型与MAC地址(假设客户端的信息)
server-name        通知给DHCP客户端的服务器名称
fixed-address ip   分配给客户端的IP地址
------------------ ----------------------------------------------

注意: 在客户端发出分配IP请求的时候，服务器也会根据客户端的信息决定IP的分配。所以在参数一节里面，所提供的hardware相当于筛选出来具有特定特征的客户端，并分配一个指定的IP地址。配置文件是分节的，也有局部选项与全体选项之分。

下面是一些重要的声明:

subnet [network_id] netmask [subnet_mask_id]

    : 该区块用于指明一个网络地址资源名称。表示这些将用于DHCP的相关选项

range [start_ip_addr] [end_ip_addr]

    : 表明地址池里的动态IP地址范围

host [hostname]

    : 对主机名下面的DHCP配置，里面通常有hardware,fixed-address等参数

filename [boot_file_path]

    : 从网络启动时的文件的名称

最后是一些选项:

------------------- ---------------------------------------------
subnet-mask         为客户端设定子网掩码
domain-name         为客户端指定域名
domain-name-servers 为客户端指明DNS的IP地址
host-name           指定客户端的主机名
routers             指定客户端的默认网关
broadcast-address   指定客户端的广播地址
ntp-server          客户端的时间服务器地址
time-offset         客户端与格林威治时间的偏移(时区)，以秒为单位
------------------- ---------------------------------------------

`/var/lib/dhcpd/dhcpd.leases`里面保存一系列的租约声明(包括有客户端的主机名等等信息)。

启动的时候按照一般的daemon进行就可以了。
